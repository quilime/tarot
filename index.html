<html>
<head>
  <title>tarot</title>
  <script src="tarot.js"></script>
  <style>
    a {
      color:#000;
    }
    table {
      float:left;
    }
    table td {
      padding:0 1em;
    }
    #info {
      float:left;
      margin-left:1em;
      max-width:400px;
    }
    #info h4 {
      margin-top:3px;
    }
  </style>
</head>
<body>

Birthday

<select id="BirthYear">
  <option disabled selected="selected">Year</option>
</select>

<select id="M">
<option disabled selected="selected">Month</option>
</select>

<select id="D">
<option disabled selected="selected">Day</option>
</select>

Until

<select id="EndYear">
  <option disabled selected="selected">Year</option>
</select>

<button onClick="calc();">Calc</button><br /><br />

<table id="table">
  <thead>
    <tr style="font-weight:bold;">
      <td>Year</td>
      <td>Age</td>
      <td>Growth</td>
      <td>Universal</td>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="info"></div>

<a style="position:absolute; top:1em; right:1em;" href="https://github.com/quilime/tarot">source code</a>

<script>

  const $ = (id) => {
    return document.getElementById(id);
  }

  const $t = (tag) => {
    return document.getElementsByTagName(tag);
  }

  const create = (el) => {
    return document.createElement(el);
  }

  const createA = (c) => {
    const a = create("a");
    a.setAttribute("href", "#");
    a.innerHTML = `${c.num} ${c.name}`;
    a.addEventListener("click", () => {
      $("info").innerHTML = `<h4>${c.num} ${c.name}</h4>${c.desc}`;
    });
    return a;
  }

  const populateTable = (chart) => {
    var tBody = create('tbody');
    for (i in chart) {
      const r = chart[i];
      const row = tBody.insertRow(tBody.rows.length);
      const yearCell = row.insertCell(0);
      const ageCell = row.insertCell(1);
      const growthCell = row.insertCell(2);
      const uniCell = row.insertCell(3);
      yearCell.innerHTML = r.year;
      ageCell.innerHTML = r.age;
      growthCell.appendChild(createA(r.growth));
      uniCell.appendChild(createA(r.uni));
    }
    var oldTbody = $t("tbody")[0];
    table.replaceChild(tBody, oldTbody)
  }

  const calc = () => {
    const _BIRTHYEAR = $("BirthYear").value;
    const _M = $("M").value;
    const _D = $("D").value;
    const _ENDYEAR = $("EndYear").value;
    chart = getChart(_BIRTHYEAR, _M, _D, _ENDYEAR);

    populateTable(chart);

    console.log(getTSV(chart));
  }

  window.onload = (event) => {
    const now = new Date();
    const nowY = now.getFullYear();

    const bYSel = $("BirthYear");
    for (let y = nowY-120; y <= nowY; y++) {
      const o = create("option");
      o.text = y;
      o.value = y;
      bYSel.add(o);
    }

    const eYSel = $("EndYear");
    for (let y = nowY-120; y <= nowY+100; y++) {
      const o = create("option");
      o.text = y;
      o.value = y;
      eYSel.add(o);
    }

    const mSel = $("M");
    for (let m = 1; m <= 12; m++) {
      const o = create("option");
      o.text = m;
      o.value = m;
      mSel.add(o);
    }

    const dSel = $("D");
    for (let m = 1; m <= 31; m++) {
      const o = create("option");
      o.text = m;
      o.value = m;
      dSel.add(o);
    }

    bYSel.value = 2000;
    mSel.value = 1;
    dSel.value = 1;
    eYSel.value = nowY;
  };

</script>
